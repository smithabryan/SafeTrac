{% extends "base.html" %}
{% block title %}SafeTrac -- Employee{% endblock %}
{% block headSection %}
    <script src="http://code.highcharts.com/highcharts.js"></script>
    <script src="http://code.highcharts.com/modules/exporting.js"></script>
    {% load chartit %}
    {{ chart1|load_charts:"graph1" }}
	<script type="text/javascript" charset="utf-8">    
	elem = document.getElementById('rightSide');	
	$(document).ready(function()
	{    
	    chart.setSize(
	       400,
	       300,
	       false
	    );   
	    
	
	$(".chartSwitch").click(function(event) {
  		var callName = "";
  		var type = "";
		if(event.target.id == "TemperatureButton")
  		{
  			callName = "/getTemperatureData/";
  			type = "Temperature"
  		}
  		else if(event.target.id == "HumidityButton")
  		{
  			callName = "/getHumidityData/";
  			type = "Humidity"
  		}
  		else if(event.target.id == "NoiseButton")
  		{
  			callName = "/getNoiseData/";
  			type = "Noise"
  		}
  		else if(event.target.id == "ImpactButton")
  		{
  			callName = "/getImpactData/";
  			type = "Impact Force"
  		}
  		//set session (do on server through call)
  		
		$.getJSON(callName,
	        function(data){
		    	chart.yAxis[0].setTitle({
        			text: type
    			});
    			chart.series[0].setData(data[0],false);
				chart.xAxis[0].setCategories(data[1], false);
				chart.redraw();
	        }
		);		
		  		
	});	    
	});	
	setInterval(function(){
		$.getJSON("/serialSafetyFeedback/",function(data){})
	
		$.getJSON("/getNewChartData/",
	        function(data){
	        	if(data.length>0)
	        	{
	        		if(chart.series[0].length < 10)
	        		{
					    chart.series[0].addPoint(
					    	{y:data[0][1]},
					    	false,
							false
					   	);
	        		}
	         		else 
	        		{
					    chart.series[0].addPoint(
					    	{y:data[0][1]},
					        false,
					        true
					   	);
	        		}
					categories = chart.xAxis[0].categories;
					categories.push(data[0][0]);
					chart.xAxis[0].setCategories(categories, false);
					chart.redraw();
	        	}
	        }
	    )
	}, 1000);

	
	</script>
{% endblock %}

{% block content %}
<!-- Employee View  -->
        <div id="leftSide">
            <div id="profile">
                <img src="{{ STATIC_URL }}{{imgsrc}}" />
            </div>
            <div id="stats">
                <ul>
                {% for key, value in employeeInfo.items %}
                    <li>{{ key }}: {{ value }}</li>
                {% endfor %}
                </ul>
            </div>
            <button>Create Report</button>
        </div>
        <div id="rightSide">
            <div id="controls">
            </div>
            <div id="canvas">
                <div id="graph1">
                </div>
            </div>
			    <div class="chartSwitch">
	      			<a id="TemperatureButton" class="chartSwitch" href="#">Temperature</a>                
    	  			<a id="NoiseButton" class="chartSwitch" href="#">Noise</a>
      				<a id="HumidityButton" class="chartSwitch" href="#">Humidity</a>  
      				<a id="ImpactButton" class="chartSwitch" href="#">Impacts</a>
    			</div>
            <div id="status">
				  {% if not isSafe %}
	                  <div id="warning">
	                  <h2>DANGER</h2>
		                <ul>
		                {% for item in dangerValues %}
		   				    {% if item.isHigh %}
			                    <li><p>Type:{{ item.sensorName }}: {{item.dataItem.value}} is too high!</p></li>
							{% else %}
			                    <li><p>Type:{{ item.sensorName }}: {{item.dataItem.value}} is too low!</p></li>
				  			{% endif %}
		                {% endfor %}
		                </ul>
	                  </div>
	                  
				  {% else %}
	                  <h2>Workers in safe conditions</h2>
				  {% endif %}
                <table>
                    <tr>
                        <td>Temperature</td>
                        <td>Humidity</td>
                        <td>Noise</td>
                        <td>Impact</td>
                    </tr>
                    <tr>
                        <td>{{currentValues.temp}}</td>
                        <td>{{currentValues.humid}}</td>
                        <td>{{currentValues.noise}}</td>
                        <td>{{currentValues.impact}}</td>
                    </tr>
                </table>
            </div>	
        </div>
{% endblock %}