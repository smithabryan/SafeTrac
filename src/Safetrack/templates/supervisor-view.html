{% extends "base.html" %}
{% block title %}SafeTrac -- Supervisor{% endblock %}
{% block headSection %}
    <link rel=StyleSheet href="{{STATIC_URL}}css/tmp.css" type="text/css" MEDIA=screen>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.18/jquery-ui.min.js"></script>
    <script type="text/javascript" src="{{STATIC_URL}}js/jquery.qtip-1.0.0-rc3.min.js"></script> 
    <script src="{{STATIC_URL}}scripts/supportFun.js"></script>
    <script src="{{STATIC_URL}}scripts/supervisor-view.js"></script>
    
    <script src="http://code.highcharts.com/highcharts.js"></script>
    <script src="http://code.highcharts.com/modules/exporting.js"></script>
    {% load chartit %}
    {{ chart1|load_charts:"graph1" }}
	<script type="text/javascript" charset="utf-8">    
	$(document).ready(function()
	{    
	    
		//put goals in chart
		$.getJSON("/getGoalData/",
	        function(data){
        		chart.addSeries({
        		    data: data.slice(0,chart.series[0].data.length),
        		    name: "Goal"
		        });
	        }
		);
	    
	//toggle for the different charts
	$(".chartSwitch").click(function(event) {
  		var callName = "";
  		var type = "";
		if(event.target.id == "TemperatureButton")
  		{
  			callName = "/getTemperatureData/";
  			type = "Temperature"
  		}
  		else if(event.target.id == "HumidityButton")
  		{
  			callName = "/getHumidityData/";
  			type = "Humidity"
  		}
  		else if(event.target.id == "NoiseButton")
  		{
  			callName = "/getNoiseData/";
  			type = "Noise"
  		}
  		else if(event.target.id == "ImpactButton")
  		{
  			callName = "/getImpactData/";
  			type = "Impact Force"
  		}
  		
		$.getJSON(callName,
	        function(data){
		    	chart.yAxis[0].setTitle({
        			text: type
    			});
    			
    			chart.series[0].setData(data[0],false);
				chart.xAxis[0].setCategories(data[1], false);
				
				//remove old goals
				for (var i = 0; i < chart.series.length; i++)
				{
					if(chart.series[i].name == "Goal")
					{
						// change a series options
						chart.series[i].options.showInLegend = false;

						// hide different parts of legend item - it's specific for different series types
						chart.series[i].legendItem.hide();
						chart.series[i].legendSymbol.hide();
						chart.series[i].legendLine.hide();
						chart.series[i].remove(true)					
						//chart.series = chart.series.splice(i,1);
					}				
				}
				//get new goals and add them.
				//put goals in chart at start
				$.getJSON("/getGoalData/",
	        		function(data){
	        			if(data.length > 0)
	        			{
        					chart.addSeries({
        		    			data: data.slice(0,chart.series[0].data.length),
    	   		    			name: "Goal"
		        			});
	       				}
	        		}
				);
				chart.redraw();
	        }
		);		
		  		
	});	    
	});	
	setInterval(function(){
		$.getJSON("/serialSafetyFeedback/",function(data){});
		$.getJSON("/serialSafetyRefresh/",function(data){
			$('#status').replaceWith(data);
		});
		
		$.getJSON("/getNewChartData/",
	        function(data){
	        	if(data.length>0)
	        	{
	        		if(chart.series[0].data.length < 10)
	        		{
					    chart.series[0].addPoint(
					    	{y:data[0][1]},
					    	false,
							false
					   	);
	        		}
	         		else 
	        		{
					    chart.series[0].addPoint(
					    	{y:data[0][1]},
					        false,
					        true
					   	);
	        		}
					categories = chart.xAxis[0].categories;
					categories.push(data[0][0]);
					chart.xAxis[0].setCategories(categories, false);
					//put goals in chart
					$.getJSON("/getGoalData/",
	        			function(data){
	        				if(data.length > 0)
	        				{
        						chart.addSeries({
        			    			data: data.slice(0,chart.series[0].data.length),
    	    		    			name: "Goal"
			        			});
	        				}
	        			}
					);
					chart.redraw();
	        	}
	        }
	    );
	}, 1000);
	</script>
{% endblock %}

{% block titleTextImage %}
            <div id="supervisorTitle"> 
            	<img id="titleImage" src="{{ STATIC_URL }}assets/title.png"> 
            </div>
{% endblock %}

{% block content %}
<div class="page">
	<div>
    <a href="supervisor/?page=manage">Manage</a>
    </div>
    <div id="leftSide">
        <h2>Group</h2>
        <div id="groupBlk">
            <button id="all">Select All</button>
            <button id="none">Deselect All</button>
            <ul id="member">
            </ul>
        </div>
    </div>
    <div id="rightSide">
        <div id="control">
        </div>
        <div id="canvas">
            <div id="graph1">
            </div>
        </div>
	    <div class="chartSwitch">
     		<a id="TemperatureButton" class="chartSwitch" href="#">Temperature</a>                
  			<a id="NoiseButton" class="chartSwitch" href="#">Noise</a>
 			<a id="HumidityButton" class="chartSwitch" href="#">Humidity</a>  
			<a id="ImpactButton" class="chartSwitch" href="#">Impacts</a>
		</div>
        <div id="status">
            <h2>Summary</h2>
            <div id="summary">
            <h3>Normal</h3>
                <ul>
                </ul>
            </div>
            <button id="tableHeader"> Details </button>
            <table id="memberTable">
            </table>
        </div>
    </div>
</div>
{% endblock %}
{%block footer %}
{% endblock %}
